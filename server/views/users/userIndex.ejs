<% include ../partials/head %>

<script src="/js/libs/mustache.js"></script>

<% if (array) { %>
  <ul class="collection">
    <% for (var result in array) {%>
      <li class="collection-item">
        <% id = array[result]._id %>
        <div id="user-<%= id %>-container">
          <div id="user-<%= id %>-content">
            <a class="user-delete secondary-content" onClick="if (confirm('Are you sure?')) {deleteRequest('<%= id %>')}" href=""><i class="material-icons">delete</i></a>
            <a class="user-edit secondary-content" onClick="editRequest('<%= id %>', '<%= array[result].name %>', '<%= array %>'); return false;" href=""><i class="material-icons">edit</i></a>
            <%= array[result].name %>
            <p><%= array[result].email %></p>
          </div>
        </div>
      </li>
    <% } %>
  </ul>
<% } %>

<script>
  function deleteRequest(id) {
    $.ajax({
      type: 'DELETE',
      url: `http://localhost:3000/user/${id}`
    });
    location.reload();
    alert('User Deleted');
  }
  function editRequest(id, name, array) {
    var template = $('#user-edit-form-template').html();
    var html = Mustache.render(template, {id, name, array});
    $(`#user-${id}-content`).remove();
    $(`#user-${id}-container`).append(html);
  }

  // function restore(id, array) {
  //   for (var i=0; i < array.length; i++) {
  //     if (array[i]._id === id) {
  //         user = array[i];
  //     }
  //   }
  //   if(user !== undefined) {
  //     var id = user.id;
  //     var name = user.name;
  //     var email = user.email;
  //     var template = $('#user-list-item').html();
  //     var html = Mustache.render(template, {id, name, email});
  //     $(`#user-${id}-content`).remove();
  //     $(`#user-${id}-container`).append(html);
  //   } else {
  //     alert('Something went wrong');
  //   }
  // }
</script> 

<script id='user-edit-form-template' type="text/template">
  <div class="row card-panel user-{{id}}-content">
    <!--<button class="right" onclick="restore('{{id}}', '{{array}}')" name="action" style="background: rgba(0,0,0,0); border: none;">
      <i class="material-icons">close</i>
    </button>-->
    <form method="post" action="/user/update/{{id}}">
      <div class="input-field">
        <input id="name" type="text" class="validate" name="name" value="{{name}}">
        <label class="active" for="name">Name</label>
      </div>
      <button class="btn waves-effect waves-light right" type="submit" name="action">Submit
        <i class="material-icons right">send</i>
      </button>
    </form>
  </div>
</script>

<!--
<script id="user-list-item" type="text/template">
  <div id="user-{{id}}-container">
    <div id="user-{{id}}-content">
      <a class="user-delete secondary-content" onClick="deleteRequest('{{id}}')" href=""><i class="material-icons">delete</i></a>
      <a class="user-edit secondary-content" onClick="editRequest('{{id}}', '{{name}}'); return false;" href=""><i class="material-icons">edit</i></a>
      {{name}}}
      <p>{{email}}}</p>
    </div>
  </div>
</script> -->

<% include ../partials/foot %>